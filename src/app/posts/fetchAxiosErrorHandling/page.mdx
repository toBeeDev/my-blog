import ArticleLayout from "@/shared/components/article/ArticleLayout";

import photo1 from "./1.png";
import photo2 from "./2.png";
import photo3 from "./3.png";
import photo4 from "./4.png";
import photo5 from "./5.png";
import photo6 from "./6.png";
import photo7 from "./7.png";

export const article = {
  author: "Bee",
  date: "2025-02-10",
  title: "âš ï¸ Fetch & Axios Error Handling",
  description: "ğŸ’¡ Fetchì™€ Axiosë¥¼ í†µí•œ ì—ëŸ¬ í•¸ë“¤ë§ì— ëŒ€í•œ ì •ë¦¬ê¸€",
};

export const metadata = {
  title: article.title,
  description: article.description,
};

export default (props) => <ArticleLayout article={article} {...props} />;

<aside>ğŸ’¡ Fetchì™€ Axiosë¥¼ í†µí•œ ì—ëŸ¬ í•¸ë“¤ë§ì— ëŒ€í•œ ì •ë¦¬</aside>

## Error Layer

ì—ëŸ¬ë ˆì´ì–´ë¥¼ êµ¬ë¶„ ì§€ì—ˆê³ , í° í•­ëª©ìœ¼ë¡œ êµ¬ë¶„ì§€ì–´ ì •ë¦¬í•˜ì˜€ìŠµë‹ˆë‹¤.

1. Http - 4xx, Network
2. Application - throw Error
3. Suspense - UnhandledError(5xx, unknown)

## Axios (feat. [axios-mock-adapter](https://www.npmjs.com/package/axios-mock-adapter))

í…ŒìŠ¤íŠ¸ì— ì•ì„œ ê¸°ì¡´ axiosClient/index.tsë¥¼ ì°¸ì¡°í•˜ì§€ì•Šê³ , ë³„ë„ì˜ test.tsë¥¼ ìƒì„±í•˜ì—¬ baseUrl ì„¤ì •ì„ localhost:3000ìœ¼ë¡œ ì„¸íŒ…í•œ ì´í›„ ì§„í–‰í•˜ì˜€ìŠµë‹ˆë‹¤.

## Network Error

<Image src={photo1} />

- ê¸°ì¡´
  Network Error ì— ëŒ€í•œ ë¡œê¹…ì´ `error(error.tsx)`, `warning(axios interceptor)` ì—ì„œ ì¤‘ë³µì ìœ¼ë¡œ ì¡íˆê³  ìˆë˜ ìƒí™©
- ë³€ê²½
  Network Error ì— ëŒ€í•œ ë¡œê¹…ì€ `warning(axios interceptor)` ì—ì„œë§Œ ë¡œê¹…ë˜ë„ë¡ ìˆ˜ì •

  <Image src={photo2} />

      - í…ŒìŠ¤íŠ¸ ì½”ë“œ

          ```tsx
          const mock = new MockAdapter(axios)
                mock.onGet('/api/health').networkError()
                const test = axios.get('/api/health', {
                  method: 'GET'
                })
          ```

---

## 5xx Error

- ê¸°ì¡´
  5xxì— ëŒ€í•œ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ìƒì„±í•˜ì˜€ìœ¼ë©°, ì¡°ê±´ë¬¸ì„ í†µí•´ 500ëŒ€ ì—ëŸ¬ì— ëŒ€í•œ ë³„ë„ì˜ ì—ëŸ¬ ë¡œê¹…ì´ ì´ë£¨ì–´ì§€ê³  ìˆì—ˆë˜ ìƒí™© - ê¸°ì¡´ ì½”ë“œ

  ```tsx
  const handleServerInternalError = (
    response: AxiosResponse<ErrorResData>,
    error: AxiosError<ErrorResData>
  ) => {
    const message =
      response.status != serviceUnavailableStatusCode
        ? SERVER_ERROR_MSG
        : TEMP_SERVER_ERROR_MSG;
    const serviceInternalError = new ServerInternalError(
      message,
      error.response,
      error.request
    );
    window.Rollbar?.error(serviceInternalError, error, serviceInternalError);
    return Promise.reject(serviceInternalError);
  };
  if (error.response && server5xxStatusCode <= error.response.status) {
    return handleServerInternalError(response, error);
  }
  ```

- ë³€ê²½
  5xxì— ëŒ€í•œ ì—ëŸ¬ëŠ” error.tsxì—ì„œ UnKnownError ë¡œ ì²˜ë¦¬ë˜ê²Œ ë¡œì§ ìˆ˜ì •. 5xxëŒ€ ì—ëŸ¬ì— ëŒ€í•œ í…ŒìŠ¤íŠ¸ë¥¼ ì§„í–‰

  <Image src={photo3} />

      - í…ŒìŠ¤íŠ¸ ì½”ë“œ

          ```tsx
          const mock = new MockAdapter(axios)
                mock.onGet('/api/health').reply(501)
                const test = axios.get('/api/health', {
                  method: 'GET'
                })
          ```

---

## 4xx Error

- ê¸°ì¡´
  ê¸°ì¡´ ClientReqeustError ëŠ” Errorë¥¼ extends
- ë³€ê²½
  AxiosErrorë¥¼ extendsí•˜ëŠ” êµ¬ì¡°ë¡œ ë³€ê²½
  <Image src={photo4} />

---

## Fetch

## NotFound

- ê¸°ì¡´
  ê¸°ì¡´ notfound í˜ì´ì§€ë¡œ ì´ë™ê³¼ ë¡¤ë°” ì—ëŸ¬ë¡œê¹…ì´ ë˜ê³  ìˆëŠ” ìƒí™©
- ë³€ê²½
  notfound í˜ì´ì§€ ì´ë™ ì‹œ notFoundError ì‹œ í˜ì´ì§€ ë¦¬ë‹¤ì´ë ‰íŠ¸ë§Œ ë˜ê³  ë¡¤ë°” ë¡œê¹…ì€ ë˜ì§€ ì•Šë„ë¡ ë¡œì§ ìˆ˜ì • ë° í…ŒìŠ¤íŠ¸
  [isNotFoundError()](https://github.com/vercel/next.js/blob/056b675bd94370e35ca91b8a08ad22bc63714c1b/packages/next/src/client/components/not-found.ts#L23) - í…ŒìŠ¤íŠ¸ ì½”ë“œ

  ```tsx
  catch (err: unknown) {
    if (isNotFoundError(err)) {
      return notFound()
    } else if (err instanceof ClientRequestError) {
      return notFound()
    } else {
      throw err
    }
  }
  ```

---

## 5xx

- ê¸°ì¡´
  5xx ì „ì²´ì— ëŒ€í•œ ì—ëŸ¬ë¥¼ ServerInternalError instanceë¥¼ í†µí•´ ì—ëŸ¬ë¡œê¹… - ê¸°ì¡´ì½”ë“œ

  ```jsx
  if (res.status >= 500) {
    rollbar.error(res)
    throw new ServerInternalError(JSON.parse(await res.text()).error.message)
  ```

- ë³€ê²½
  500ì—ëŸ¬ì— ëŒ€í•œ ì—ëŸ¬ì™€ headerì˜ contentTypeì´ jsoní˜•ì‹ ì¡°ê±´ë¬¸ì„ í†µí•´ ServerInternalErrorì™€ UnExpectedServerError ë¡œ êµ¬ë¶„ì§€ì–´ ì—ëŸ¬ë¡œê¹…ì„ ì§„í–‰

UnExpectedServerError ì˜ ê²½ìš°ì—ëŠ” responseì˜ statusì™€ statusTextë¥¼ ë¡œê¹…í•˜ëŠ” êµ¬ì¡°
`ex)501,502,503â€¦` - 500 && JSON í˜•ì‹

<Image src={photo5} />

    - ì´ì™¸( 501, 502, 503 &&  !JSONí˜•ì‹)

<Image src={photo6} />

    - í…ŒìŠ¤íŠ¸ì½”ë“œ

        ```jsx
        //server2.js
        //express ì„œë²„
        app.get('/test-error', (req, res) => {
          const errorCode = req.query.error

          switch (errorCode) {
            case '500':
              res.status(500).json({
                error: {
                  message: 'Internal Server Error'
                }
              })
              break
            case '501':
              res.status(501).send('Not Implemented')
              break
            case '502':
              res.status(502).send('Bad Gateway')
              break
            case '503':
              res.status(503).send('Service Unavailable')
              break
            case '504':
              res.status(504).send('Gateway Timeout')
              break
            default:
              res.send('No error code or unrecognized error code')
          }
        })

        const PORT = process.env.PORT || 8080
        app.listen(PORT, () => {
          console.log(`ì‹¤í–‰ ì¤‘ì´ë‹¤... ${PORT}`)
        })

        //fecthClient/test.ts
        const BASE_URL = 'http://localhost:8080' //baseUrl ìˆ˜ì •

        //index.ts
        const testRes = await Fetch('/test-error?error=500', {
        	method: 'GET',
        	next: {
        		revalidate: 0
          }
        })
        ```

## 4xx

4xxëŒ€ ì—ëŸ¬ì— ëŒ€í•œ í•¸ë“¤ë§ì€ ê¸°ì¡´ê³¼ ë™ì¼í•œ êµ¬ì¡°.

- ê¸°ì¡´(í˜„ìƒ ìœ ì§€)
  <Image src={photo7} />
